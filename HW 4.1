import datetime
import os
import sysargv

class Logger(object):
    def __init__(self, filename, priority='DEBUG', datetime=True, scriptname=True):
        self.filename =filename
        self.priority=priority
        if datetime:
            self.write_date = True
        if scriptname:
            self.write_scriptname = True
        try:
            fh = open(self.filename, 'a')
        except IOError:
            return None
        self.handle = fh
    
    priorities = {
        'DEBUG': 1,
        'INFO': 2,
        'WARNING': 3,
        'ERROR': 4,
        'CRITICAL': 5
    }        
    log_ling_spacer = '    '
    
    def compose_prepend(self):
        if write_date:
            dt = time.ctime()
        if write_scriptname:
            filename = os.path.basename(sys.argv[0])
        self.prependstr = str(dt)+' '+str(filename)+' '
        return self.prependstr
        
    def write_log(self, msg, priority):
            self.compose_prepend()
            if priority in priorities:
                self.handle.write(self.datetime+msg+'\n')
                for i in range(priority, 6):
                    self.write_log(msg, i)
                    

    def debug(self, msg):
               self.write_log(msg,1)
               

    def info(self, msg):
               self.write_log(msg,2)
               

    def warning(self, msg):
               self.write_log(msg,3)
               
   
    def error(self, msg):
               self.write_log(msg,4)
               
   
    def critical(self, msg):
               self.write_log(msg,5)
